# This config is equivalent to both the '.circleci/extended/orb-free.yml' and the base '.circleci/config.yml'
version: 2.1

defaults: &defaults
  docker:
    - image: circleci/node:13.8.0

jobs:
    build:
      <<: *defaults
      steps:
        - checkout
        - run: npm i
        - save_cache:
            key: "npm-packages"
            paths:
              - /src/node_modules
        - run: npm run lint
    test:
      <<: *defaults
      steps:
        - checkout
        - restore_cache:
            keys:
              - "npm-packages"
        - run: npm i
        - run: npm run test
    analyse:
      <<: *defaults
      steps:
        - checkout
        - restore_cache:
            keys:
              - "npm-packages"
        - run: npm audit

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
    node-app:
        jobs:
          - build
          - test:
              requires:
                - build
          - analyse:
              requires:
                - test
